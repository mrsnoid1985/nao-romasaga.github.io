<!DOCTYPE html>
<html lang="ja">
    <head>
        <link rel="canonical" href="/autodamage.html">
        <!-- Global site tag (gtag.js) - Google Analytics         -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138966739-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-138966739-1');
        </script>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <meta charset="utf-8">
        <title>【ロマサガRS】全力オート ダメージランキング</title>
        <meta property="og:title" content="【ロマサガRS】全力オート ダメージランキング" />
        <meta property="og:url" content="https://http://nao-romasaga.github.io/autodamage.html" />
        <meta property="og:description" content="ロマサガRSの全力オートでの平均ダメージのランキングです。覚醒パターンの研究などに攻略の際にご利用ください。" />
        <meta name="description" content="ロマサガRSの全力オートでの平均ダメージのランキングです。覚醒パターンの研究などに攻略の際にご利用ください。【ロマンシングサガ リユニバース】" />
        <meta property="og:image" content="https://nao-romasaga.github.io/img/twitter_card_autodamage.png" />
        <meta property="og:site_name" content="ロマサガRS便利ツール" />
        <meta property="og:type" content="article">
        <meta property="og:locale" content="ja_JP" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@nao_romasaga_rs" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="./js/jquery.ui.touch-punch.js"></script>

        <link rel="stylesheet" type="text/css" href="./css/bootstrap/bootstrap.min.css">
        <script src="./js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth__ja.js"></script>
        <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
        <script src="./js/Firebase.js"></script>
        <script src="./js/utils.js" ></script>
        <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
        
        <!-- http://ifs.nog.cc/hkaityo.hp.infoseek.co.jp/dq/rs2-01.html -->
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class ="dojohaikei">
            <div class="container">

                <div class="text-center">
                    <a href="https://www.jp.square-enix.com/saga_reuniverse/" target="new"><img src="./img/cmn_logo01_sp.png" class="col-sm-12 col-md-8 col-lg-6"></a>
                </div>
                <h3 class="text-center label-text">全力オート <br class="hidden spBlock">平均ダメージランキング</h3>
                <span class="title-text d-none"></span>
                <p class="text-right opacity"><small>バグ発見、ご要望は <a href="https://peing.net/ja/nao_romasaga_rs" target="new">質問箱</a>まで</small></p>
                <div id="firebaseui-auth-container" style="margin-bottom:10px;"></div>
                <br>
                <div class="width-100 card">
                        <div id="howtohead"  onclick="" class="card-header bg-primary" style="color:white; font-size:20px;"><i class="fas fa-question-circle"></i> 表示内容の読み方 (<span class="hidden pcBlock">タップで展開 </span><i class="fas fa-sort"></i>)</div>
                        <div id="howtobody" class="card-body" style="padding:0px 5px;">
                            <div class="d-md-none"><img src="/img/howto_sp.png" style="width:100%"></div>
                            <div class="d-none d-md-block d-lg-none"><img src="/img/howto_ipad.png" style="width:100%"></div>
                            <div class="d-none d-lg-block"><img src="/img/howto_pc.png" style="width:100%"></div>
                            <br>
                            スマートフォン、ipad、パソコンなど画面の大きさによって表示される内容は異なります
                        </div>
                </div>

                <div class="width-100 card">
                    <div id="jokenhead" onclick="" class="card-header bg-warning" style="color:black; font-size:20px;"><i class="fas fa-question-circle"></i> ダメージ計測条件 (<span class="hidden pcBlock">タップで展開 </span><i class="fas fa-sort"></i>)</div>
                    <div id="jokenbody" class="card-body" style="padding:0px 5px;">
                        <ul class="trianglelist list5">
                            <li>計測ターン数；9ターン。そのため通常攻撃に置き換わる技が採用されて平均ダメージが高くなっている構成があります</li>
                            <li>計測ステータス：キャラ最大素ステ、スタイルレベル最大で装備、裏なしです</li>
                            <li>敵ステータス：体/精=100で耐性0です</li>
                            <li>アビリティ発動：錬気は1T、4Tの固定2回発動です。ステータスアップや通常攻撃(杖)のバフは加味していません</li>
                            <li>アビリティ発動：弱点特攻：Weak発生時ダメージ+X%は常に発動しています</li>
                            <li>武器威力：10/22時点の最大値を採用。
                                剣=30、大剣=31、斧=31、
                                    小剣=30、弓=28、槍=30、
                                    棍棒=30、体術=30、銃=29、
                                    杖=29
                            </li>
                            <li>マスターレベル：10/22時点の最大値を採用。
                                剣=36、大剣=32、斧=28、
                                    小剣=32、弓=22、槍=33、
                                    棍棒=26、体術=32、銃=19、
                                    杖=32
                            </li>
                            <li>技ランク：全て99</li>
                            <li>技の特攻：特攻は非発動で計算しています</li>
                            <li>聖石：なしの状態で計算しています</li>
                            <li>覚醒パターンや継承パターンが異なるが技使用回数が同じ場合は「覚醒数が少ないケース」の表示されます</li>
                            <li>オートで使わない技は継承パターンに入っていません</li>
                            <li>ダブルクラッシュ、ラビットトリックは2回攻撃分。稲妻/氷結スラッシャーは3回攻撃分のダメージを表示しています</li>
                        </ul>
                    </div>
                </div>
                <!--スクエア--><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5008373409434899" data-ad-slot="9303963278" data-ad-format="auto" data-full-width-responsive="true"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({});</script>
                <div class="row">
                    <div class="col-sm-12 col-12 style-bgcolor text-center">
                        <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="text-center label-text">アビリティ発動選択</div>
                            <div style="font-size:20px;">
                                勇健強撃：HP満タン時ダメージ+X%<br>上記アビリティの常時発動<br>
                                <button class="icon_btn_off optionButton" data-on="0" data-name="lim" style="background-size: 100% 100%;">ON / OFF</button>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                                <div class="text-center label-text">範囲攻撃技評価</div>
                                <div style="font-size:20px;">
                                    範囲攻撃のダメージを下記の通り評価します<br>
                                    縦範囲/横範囲：敵3体分、全体：敵5体分<br>
                                    <button class="icon_btn_off optionButton" data-on="0" data-name="range" style="background-size: 100% 100%;">ON / OFF</button>
                                </div>
                            </div>
                        </div>
                        <div class="text-center label-text">敵種族選択</div>
                        <ul class="nav text-center width-100">
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="無し" href="#enemy_0" onclick=""><img src="http://romasagatool.com/img/e_others_495.png"><br>無し</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="人間" href="#enemy_1" onclick=""><img src="./img/enemy/type_1.png" width=69 height=69><br>人間</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="獣人" href="#enemy_2" onclick=""><img src="./img/enemy/type_2.png" width=69 height=69><br>獣人</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="獣" href="#enemy_3" onclick=""><img src="./img/enemy/type_3.png" width=69 height=69><br>獣</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="有翼" href="#enemy_4" onclick=""><img src="./img/enemy/type_4.png" width=69 height=69><br>有翼</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="植物" href="#enemy_5" onclick=""><img src="./img/enemy/type_5.png" width=69 height=69><br>植物</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="虫" href="#enemy_6" onclick=""><img src="./img/enemy/type_6.png" width=69 height=69><br>虫</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="水棲" href="#enemy_7" onclick=""><img src="./img/enemy/type_7.png" width=69 height=69><br>水棲</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="魚" href="#enemy_8" onclick=""><img src="./img/enemy/type_8.png" width=69 height=69><br>魚</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="蛇" href="#enemy_9" onclick=""><img src="./img/enemy/type_9.png" width=69 height=69><br>蛇</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="爬虫類・両生類" href="#enemy_10" onclick=""><img src="./img/enemy/type_10.png" width=69 height=69><br>爬虫類<br>両生類</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="魔族" href="#enemy_11" onclick=""><img src="./img/enemy/type_11.png" width=69 height=69><br>魔族</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="不死" href="#enemy_12" onclick=""><img src="./img/enemy/type_12.png" width=69 height=69><br>不死</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="骸骨" href="#enemy_13" onclick=""><img src="./img/enemy/type_13.png" width=69 height=69><br>骸骨</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="精霊" href="#enemy_14" onclick=""><img src="./img/enemy/type_14.png" width=69 height=69><br>精霊</a></li>
                            <li class="col-3 col-sm-1 xs-pad0"><a class="enemyfilterList pad0" data-type="EnemyClassFilter" data-label="無機質" href="#enemy_15" onclick=""><img src="./img/enemy/type_15.png" width=69 height=69><br>無機質</a></li>
                        </ul>
                        <br>                        
                        <div class="text-center label-text">武器種選択</div>
                        <ul class="nav text-center width-100">
                            <li class="col-2 col-sm-1 offset-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="剣" href="#icon_ken" onclick=""><span class="icon_mini icon_ken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="大剣" href="#icon_dken"><span class="icon_mini icon_dken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="斧" href="#icon_ono"><span class="icon_mini icon_ono" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="棍棒" href="#icon_kon"><span class="icon_mini icon_kon" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="体術" href="#icon_tai"><span class="icon_mini icon_tai" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="銃" href="#icon_ju"><span class="icon_mini icon_ju" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="小剣" href="#icon_sken"><span class="icon_mini icon_sken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="弓" href="#icon_yumi"><span class="icon_mini icon_yumi" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="槍" href="#icon_yari"><span class="icon_mini icon_yari" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="杖" href="#icon_tsue"><span class="icon_mini icon_tsue" onclick=""></span></a></li>
                        </ul>
                        <div class="text-center label-text" id="CHAR_HEADER">キャラ選択</div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_ken"><h5 class="game-banner"><span class="icon_mini icon_ken"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_dken"><h5 class="game-banner"><span class="icon_mini icon_dken"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_ono"><h5 class="game-banner"><span class="icon_mini icon_ono"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_sken"><h5 class="game-banner"><span class="icon_mini icon_sken"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_yumi"><h5 class="game-banner"><span class="icon_mini icon_yumi"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_yari"><h5 class="game-banner"><span class="icon_mini icon_yari"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_ju"><h5 class="game-banner"><span class="icon_mini icon_ju"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_tai"><h5 class="game-banner"><span class="icon_mini icon_tai"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_kon"><h5 class="game-banner"><span class="icon_mini icon_kon"></span></h5></div>
                        <div class="opacity-char-back weaponList d-none" id="_icon_tsue"><h5 class="game-banner"><span class="icon_mini icon_tsue"></span></h5></div>                    
                        <div class="opacity-char-back weaponList d-none" id="_icon_toku"><h5 class="game-banner"><img src="/img/icon/icon_toku.png"></h5></div>                    
                        <div class="text-center label-text" id="STYLE_HEADER">スタイル選択</div>
                        <div id="styleChoice"></div>
                        <div class=" table-dark">
                            <table class="width-100 text-center table-dark">
                                <tr class="char-bottom">
                                    <td colspan=8 class="text-center label-text">敵情報</td>
                                </tr>
                                <tr class="char-bottom">
                                    <td colspan=2>名称</td>
                                    <td colspan=2 id="enemy_name"></td>
                                    <td colspan=2>特攻</td>
                                    <td colspan=2 id="enemy_crit"></td>
                                </tr>
                            </table>
                            <table class="width-100 text-center table-dark pad0">
                                        <tr class="char-bottom">
                                    <th><span class="icon_xs_zokusei icon_zan"></span></th>
                                    <th><span class="icon_xs_zokusei icon_da"></span></th>
                                    <th><span class="icon_xs_zokusei icon_totsu"></span></th>
                                    <th><span class="icon_xs_zokusei icon_netsu"></span></th>
                                    <th><span class="icon_xs_zokusei icon_rei"></span></th>
                                    <th><span class="icon_xs_zokusei icon_rai"></span></th>
                                    <th><span class="icon_xs_zokusei icon_yo"></span></th>
                                    <th><span class="icon_xs_zokusei icon_in"></span></th>
                                </tr>
                                <tr>
                                    <td id="resist_zan">0</td>
                                    <td id="resist_da">0</td>
                                    <td id="resist_totsu">0</td>
                                    <td id="resist_netsu">0</td>
                                    <td id="resist_rei">0</td>
                                    <td id="resist_rai">0</td>
                                    <td id="resist_yo">0</td>
                                    <td id="resist_in">0</td>
                                </tr>
                            </table>
                        </div>                        
                    </div>
                    <div class="col-12">
                        <h3 class="text-center label-text" style="padding-top:10px;padding-bottom:10px;"><span id="ENEMY"></span><span id="TARGET">全スタイル</span><br class="hidden spBlock"> 平均ダメージランキング</span></h3>
                        <label class="badge badge-pill badge-light"><span id="LIMIT_LABEL"></span></label>
                    </div>
                    <div class="col-12">
                            <div id="RANK_AREA" class="row"></div>
                            <div id="RANK_AREA2" class="row"></div>
                    </div>
                </div>
            </div><!-- isLogin -->
            </div>
        </div>
        <script src="./js/data_CHARMASTER.js" ></script>
        <script src="./js/data_STYLEMASTER_style.js" ></script>
        <script src="./js/data_SKILLMASTER_list.js" ></script>
        <script>
var ENEMY_RESIST = [
    [0,0,0,0,0,0,0,0,"なし","なし"],
    [-45,0,0,30,30,30,30,-45,"人間","キラーマシン"],
    [0,0,30,-45,-45,-45,0,0,"巨人 男性","オーガロード"],
    [0,30,0,0,0,0,0,0,"獣","ヌエ"],
    [0,0,-35,0,50,0,0,0,"竜 浮遊","ワンダーラスト"],
    [0,30,0,-55,30,0,0,0,"植物","ラッフルツリー"],
    [0,-35,0,0,-35,0,50,0,"虫 浮遊","アレフ"],
    [30,0,-55,0,-45,-45,0,0,"水棲","首長竜"],
    [0,-35,0,0,-35,-35,0,0,"魚","死海魚"],
    [30,0,0,30,-55,-45,0,0,"爬虫類","ザッハーク"],
    [0,0,0,0,-45,-45,0,0,"両生類 カエル","カエル術士"],
    [0,0,0,50,50,50,-45,50,"悪魔","戦鬼"],
    [0,0,-35,-35,50,0,-55,50,"巨人 不死","ポイゾンギアン"],
    [0,-35,30,-45,50,0,-55,50,"竜 不死 骨","チャリオット"],
    [-45,0,0,30,30,30,30,30,"火精,土精,岩石","マグマ"],
    [30,50,30,-45,-45,-45,-45,-45,"虫","ゴールデンバウム"],
];

$(".opacity-char-back").slideUp();
$("#_icon_ken").slideDown();
$("#CHAR_HEADER").hide();
$("#STYLE_HEADER").hide();
$("#LIMIT_LABEL").hide();
$("#howtobody").slideUp();
$("#jokenbody").slideUp();

$("#howtohead").click(function(){
    gtag('event', "clickHowto", {'event_category': "autodamage", 'event_label': "open", 'value': 1});
    $("#howtobody").slideToggle()
});
$("#jokenhead").click(function(){
    gtag('event', "clickJoken", {'event_category': "autodamage", 'event_label': "open", 'value': 1});
    $("#jokenbody").slideToggle()
});

var limOrder = "";
var cid = "";
var sid = "";
var dup = false;
var lastParam = {};

$("#LIMIT_BUTTON").click(function () {
    var now = $(this).text();
    $(this).toggleClass("icon_btn_off");
    $(this).toggleClass("icon_btn_on");
    var onoff = $(this).attr("data-lim");
    gtag('event', "clickLimitAbility", {'event_category': "autodamage", 'event_label': onoff, 'value': 1});
    if(onoff == 0) {
        // オン
        limOrder = "lim";
        $(this).attr("data-lim", 1);
        $("#LIMIT_LABEL").show();
    }else {
        // オフ
        limOrder = "";
        $(this).attr("data-lim", 0);
        $("#LIMIT_LABEL").hide();
    }
    console.log("limit", lastParam);
    callAPI(lastParam);
});

$(".enemyfilterList").click(function () {
    $("#styleChoice").html("");
    $("#STYLE_HEADER").hide();

    //$(".weaponList").slideUp();

    let value = $(this).attr("href").substr(7);
    let label = $(this).attr("data-label");
    let isActive = $(this).parent().hasClass("filterActive");
    $(".enemyfilterList").each(function () {
        $(this).parent().removeClass("filterActive");
    });
    gtag('event', "clickEnemy", {'event_category': "autodamage", 'event_label': label, 'value': 1});
    if (isActive) {
        setResitCrit(ENEMY_RESIST[0]);
        $("#ENEMY").html(``);
        //lastParam['dup'] = true;
        delete lastParam['enemy'];
        lastParam['limit'] = 1000;
        callAPI(lastParam);
    } else {
        setResitCrit(ENEMY_RESIST[value]);
        var x = (label !== "無し") ? `VS ${label}の` : "";
        $("#ENEMY").html(x);
        $(this).parent().toggleClass("filterActive");

        //lastParam['dup'] = true;
        lastParam['enemy'] = value;
        lastParam['limit'] = 1000;
        callAPI(lastParam);
    }
});
function setResitCrit(list){
    setTaisei($("#resist_zan"), list[0]);
    setTaisei($("#resist_da"), list[1]);
    setTaisei($("#resist_totsu"), list[2]);
    setTaisei($("#resist_netsu"), list[3]);
    setTaisei($("#resist_rei"), list[4]);
    setTaisei($("#resist_rai"), list[5]);
    setTaisei($("#resist_yo"), list[6]);
    setTaisei($("#resist_in"), list[7]);
    $("#enemy_crit").html(list[8]);
    $("#enemy_name").html(list[9]);
}


$(".filterList").click(function () {
    $("#styleChoice").html("");
    $("#STYLE_HEADER").hide();
    
    $(".weaponList").slideUp();

    let value = $(this).attr("href").substr(1);
    gtag('event', "clickFilter", {'event_category': "autodamage", 'event_label': value, 'value': 1});
    if ($(this).parent().hasClass("filterActive")) {
        //$("#TARGET").html(`全スタイル`);
        $("#CHAR_HEADER").hide();
        // 解除
        $(".filterList").each(function () {
            $(this).parent().removeClass("filterActive");
        });
        $("#TARGET").html(`全スタイル`);
        lastParam['dup'] = true;
        delete lastParam['cid'];
        delete lastParam['sid'];
        delete lastParam['btype'];
        callAPI(lastParam);
    } else {
        $("#CHAR_HEADER").show();
        // 絞り込み
        //$(".SeriesChoise").addClass("d-none");
        $("#_" + value).removeClass("d-none",0, function(){
            $("#_" + value).slideDown();
        });
        $("#TARGET").html(`<span class="icon_mini ${value}"></span>`);
        $(".filterList").each(function () {
            $(this).parent().removeClass("filterActive");
        });
        $(this).parent().toggleClass("filterActive");
        lastParam['dup'] = true;
        delete lastParam['cid'];
        delete lastParam['sid'];
        lastParam['btype'] = value.substr(5);
        callAPI(lastParam);
    }
});

$(document).on("click",".char",function(){
    let charId = $(this).attr("data-id");
    var charInfo = CHAR_MASTER[charId];
    gtag('event', "clickChar", {'event_category': "autodamage", 'event_label': charInfo['Name'], 'value': 1});
    $("#TARGET").html(charInfo['Name']);
    $("#STYLE_HEADER").show();
    $("#styleChoice").html("");
    for (let styleId of charInfo['Holders']) {
        if(STYLE_MASTER[styleId] === undefined){
            continue;
        }
        let styleInfo = STYLE_MASTER[styleId];
        // スタイルアイコンの追加
        let icon = $("<button>").addClass("style")
                .addClass(getStyleIconClass(styleInfo['Rarity']))
                .attr("style", `background:url(./img/style_icon/${styleId}.png) no-repeat;`)
                .attr("data-id", styleId);
        let background = $("<span>")
                .addClass(getStyleIconBgClass(styleInfo['Rarity']))
                .append(icon);
        $("#styleChoice").append(background);
    }
    lastParam['dup'] = false;
    lastParam['cid'] = charId;
    callAPI(lastParam);
});

$(document).on("click",".style",function(){
    let styleId = $(this).attr("data-id");
    var styleInfo = STYLE_MASTER[styleId];
    gtag('event', "clickStyle", {'event_category': "autodamage", 'event_label': styleInfo['Name']+styleInfo['AnotherName'], 'value': 1});
    $("#TARGET").html(styleInfo['Name']+" <br class=\"hidden spBlock\">"+styleInfo['AnotherName']+"<br class=\"hidden pcBlock\">");
    lastParam['dup'] = false;
    lastParam['sid'] = styleId;
    callAPI(lastParam);
});
var dupDelFlg = true;

$(document).ready(function ($) {
    dispChar(CHAR_MASTER);
});
callAPI({'dup':true});

function callAPI(param){
    lastParam = param;
    console.log(lastParam);
    dupDelFlg = param['dup'];
    var cid = (param['cid'] !== undefined) ? `&cid=${param['cid']}` : "";
    var sid = (param['sid'] !== undefined) ? `&sid=${param['sid']}` : "";
    var enemy = (param['enemy'] !== undefined) ? `&enemy=${param['enemy']}` : "";
    var btype = (param['btype'] !== undefined) ? `&btype=${param['btype']}` : "";
    var limit = (cid !== "") ? 30 : 1000;
    var order = (limOrder !== "") ? `&order=${limOrder}` : "";
    var dup = (dupDelFlg) ? "&dup=true" : "";
//                $("#RANK_AREA").slideUp(200,function(){
        $("#RANK_AREA").html("");
        $.getJSON(`https://romasagatool.com/api/auto_ranking2.php?limit=${limit}${cid}${sid}${enemy}${btype}${order}${dup}&callback=?`);
        //console.log(`?limit=${limit}${cid}${sid}${enemy}${btype}${order}${dup}`);
//                    $("#RANK_AREA").slideDown(200);
//                });
}

function callback(data){

    var styleList = [];
    for(var rank in data) {
        var rec = data[rank];
        if($.inArray(rec['sid'], styleList) > -1){
            continue;
        }
        if(dupDelFlg){
            //styleList.push(rec['sid']);
        }

        var skills = rec['pattern'].split("/");
        var skillList = [];
        var skillMap = {};
        //console.log(STYLE_MASTER[rec['sid']]);
        var turnAction = rec['turnaction'].split("/");
        for(var tmp of skills) {
            var tmpdata = tmp.split(":");
            var skillId = tmpdata[0];
            var bp = tmpdata[1];
            var damage = tmpdata[2];
            var limDamage = tmpdata[3];
            var useCount = tmpdata[4];
            var name = (SKILL_MASTER[skillId] !== undefined) ? SKILL_MASTER[skillId]['Name'] : "通常攻撃";
            skillList.push(skillId);
            skillMap[skillId] = {};
            skillMap[skillId]['id'] = skillId;
            skillMap[skillId]['name'] = name;
            skillMap[skillId]['damage'] = (limOrder == "") ? damage : limDamage;
            skillMap[skillId]['bp'] = bp;
            skillMap[skillId]['count'] = useCount;
            //console.log(name, skillId, damage, useCount, bp);
        }
        var totalDamage = (limOrder == "") ? rec['anydamage'] : rec['limdamage'];
        var skillDiv = "";

        var mySkill = [skillMap['normal']];
        var dispSkill = [skillMap['normal']];
        delete skillMap['normal'];
        for(var skillId of STYLE_MASTER[rec['sid']]['SkillIds']){
            mySkill.push(skillId);
            dispSkill.push(skillMap[skillId]);
            delete skillMap[skillId];
        }
        for(var skillId in skillMap){
            dispSkill.push(skillMap[skillId]);
            delete skillMap[skillId];
        }
        var skillDivSmList = [];
        for(var i in dispSkill){
            // console.log(i, dispSkill);
            // console.log(dispSkill[i]);
            var skillId = dispSkill[i]['id']; 
            var numClass = (dispSkill[i]['count'] > 0) ? "fuchidoriWhite" : "fuchidoriRed";
            
            var isKeisho = (mySkill.indexOf(skillId) === -1) ? true : false;
            var kakusei = skillId === "normal" ? 0 : SKILL_MASTER[skillId]['Kakusei'];
            var kakuseid = skillId === "normal" ? 0 : Number(SKILL_MASTER[skillId]['ConsumeBp']) - Number(dispSkill[i]['bp']);
            var topLine = isKeisho ? `style="border-top: 2px ivory solid;"` : "";

            var k = "";
            for(var j = 0; j<kakusei; j++){
                k+= (j >= kakuseid) ? "◇" : "◆";
            }
            var bpDisp = skillId === "normal" ? "" : `BP:${dispSkill[i]['bp']} (${k}) `;
            skillDiv += `<div class="col-2 text-center d-none d-lg-block text-nowrap">${dispSkill[i]['name']}<br>`+
                `<span class="${numClass} damageNumber">${Number(dispSkill[i]['damage']).toLocaleString() } </span><br>`+
                `${bpDisp}${dispSkill[i]['count']}回`+
                `</div>`;
            skillDivSmList.push(`<tr ${topLine} ><td>${dispSkill[i]['name']}(${dispSkill[i]['bp']})</td><td><span class="${numClass} damageNumber">${Number(dispSkill[i]['damage']).toLocaleString() } </span></td><td>${k}</td><td>${dispSkill[i]['count']}回</td></tr>`);
        }
        var skillDvSm = `<div class="col-12 d-lg-none"><table class="width-100">` +skillDivSmList.join("")+"</table></div>";

        var turnSkill = [];
        for(var tmp of turnAction){
            var x = tmp.split(":");
            var name = x[1] === "normal" ? "通常攻撃" : SKILL_MASTER[x[1]]['Name'];
            name = name.length > 4 ? name.substr(0,4)+"…" : name;
            turnSkill.push(`${name}(${x[2]})`);
        }
        $rank = $(`
        <div class="col-12 col-md-12 style-skill-list" style="padding: 0px 5px;">
            <div class="row no-gutters" onclick="$(&quot;.flvID68ffe21&quot;).slideToggle();">
                <div class="char dot_mid dot char-hashiri" style="top:5px; position: absolute; background: url(./img/dot/${STYLE_MASTER[rec['sid']]['DotId']}.png);"></div>
                <div class="d-none d-md-block" style="width:100%;height:100%;position: absolute;background: url(./img/style_cutin/${rec['sid']}.png) no-repeat; background-size: contain; background-position: center; opacity: 0.3;"></div>
                <div class="d-md-none" style="width:100%;height:100%;position: absolute;background: url(./img/style_all/${rec['sid']}.png) no-repeat; background-size: contain; background-position: center; opacity: 0.3;"></div>
                <div class="col-md-3 col-lg-2  d-none d-sm-block text-nowrap">
                    <div style="padding-left:50px;">${STYLE_MASTER[rec['sid']]['Name']}<br><span class="fuchidoriJewel damageNumber" style="font-size:25px">${totalDamage}</span></div>
                    <div>${STYLE_MASTER[rec['sid']]['AnotherName']}</div>
                </div>
                <div class="col-9 d-none d-md-block d-lg-none">${turnSkill.join(" ⇨ ")}</div>
                ${skillDiv}
                <div class="col-12 d-sm-none text-nowrap">
                    <div style="padding-left:50px;">${STYLE_MASTER[rec['sid']]['Name']} ${STYLE_MASTER[rec['sid']]['AnotherName']}<br><span class="fuchidoriJewel damageNumber" style="font-size:25px">${totalDamage}</span></div>
                </div>
                ${skillDvSm}
                <div class="col-12 d-none d-lg-block" style="border-top: 2px solid ivory;">${turnSkill.join(" ⇨ ")}</div>
            </div>
        </div>

        `);
        $("#RANK_AREA").append($rank);
    }
};
        </script>
    </body>
</html>

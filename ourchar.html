<!DOCTYPE html>
<html lang="ja">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics         -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138966739-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-138966739-1');
        </script>
        <meta charset="utf-8">
        <title>ロマサガRS ステータスランキング みんなの育成状況</title>
        <meta property="og:title" content="ロマサガRS ステータスランキング みんなの育成状況" />
        <meta property="og:url" content="https://http://nao-romasaga.github.io/ourchar.html" />
        <meta property="og:description" content="ロマサガRSのキャラクターのステータスランキングです。ユーザが登録したデータからキャラクター毎に最大値をランキングで調べるツールです。攻略や育成の際にご利用ください。" />
        <meta name="description" content="ロマサガRSのキャラクターのステータスランキングです。ユーザが登録したデータからキャラクター毎に最大値をランキングで調べるツールです。攻略や育成の際にご利用ください。【ロマンシングサガ リユニバース】" />
        <meta property="og:image" content="https://nao-romasaga.github.io/img/twitter_card_ourchar.png" />
        <meta property="og:site_name" content="ロマサガRS便利ツール" />
        <meta property="og:type" content="article">
        <meta property="og:locale" content="ja_JP" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@nao_romasaga_rs" />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
        <script type="text/javascript" src="./js/jquery.ui.touch-punch.js"></script>
        <link rel="stylesheet" href="./css/tabulator.css">
        <script type="text/javascript" src="./js/tabulator.js"></script>

        <link rel="stylesheet" type="text/css" href="./css/bootstrap/bootstrap.min.css">
        <script src="./js/popper.min.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth__ja.js"></script>
        <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
        <script src="./js/Firebase.js"></script>
        <script src="./js/utils.js" ></script>
        <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" >

        <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
        <!-- http://ifs.nog.cc/hkaityo.hp.infoseek.co.jp/dq/rs2-01.html -->
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <style>
            .filterActive{
                background-color: #93CBFF !important;
                border: 1px solid #0000FF !important;
                border-radius: 3px;
            }
            .paramLabel{
                background-color: papayawhip;
            }
            .paramHead{
                background-color: lightyellow;
            }
            .paramCell2{
                width:8%;
                border-left: 1px solid #faf0b4                            
            }
            .dotBackground{
                width: 10%;
                border-radius: 15px;                            
            }
            .bg1{
                background: url(./img/bg_renkei_1.png);
                background-size: contain;
            }
            .bg2{
                background: url(./img/bg_renkei_2.png);
                background-size: contain;
            }
            .bg3{
                background: url(./img/bg_renkei_3.png);
                background-size: contain;
            }
            .bg4{
                background: url(./img/bg_renkei_4.png);
                background-size: contain;
            }
            .bg5{
                background: url(./img/bg_renkei_5.png);
                background-size: contain;
            }            
        </style>
    </head>
    <body>
        <div class ="haikei">
            <div class="container">
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

                <div class="text-center">
                    <a href="https://www.jp.square-enix.com/saga_reuniverse/" target="new"><img src="https://www.jp.square-enix.com/saga_reuniverse/assets/img/cmn_logo01_sp.png" class="col-sm-12 col-md-8 col-lg-6"></a>
                </div>
                <h3 class="text-center title-text changeBase" data-base=0>キャラクター<br class="hidden spBlock">育成ランキング<span class="hidden pcBlock"><br>みんなの育成状況</span></h3>
                <p class="text-right opacity"><small>バグ発見、ご要望は <a href="https://twitter.com/nao_romasaga_rs" target="new">nao_romasaga_rs</a>まで</small>
                </p>
                <div id="firebaseui-auth-container" style="margin-bottom:10px;"></div>
                <br>
                <!--
                <div class="noLogin opacity kadomaru bg-danger text-white"><i class="fas fa-exclamation-triangle"></i>本機能はログイン必須です<br>Twitterログインを行い、<a href="./style.html" style="color:lightskyblue">キャラ+スタイル詳細</a>あるいは<a href="./party.html" style="color:lightskyblue">ステータス上限チェック</a>で所持しているキャラクターのステータスを入力した後からご利用できます。</div>
                <div class="isLogin d-none">
                -->
                <div class="isLogin">
                    <label class="badge badge-pill badge-light">絞り込み</label>
                    <div class="style-bgcolor text-center small row" style="width:100%; margin: 0px;">
                        <ul class="nav text-center width-100">
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="剣" href="#icon_ken"><span class="icon_mini icon_ken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="大剣" href="#icon_dken"><span class="icon_mini icon_dken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="斧" href="#icon_ono"><span class="icon_mini icon_ono" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="棍棒" href="#icon_kon"><span class="icon_mini icon_kon" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="体術" href="#icon_tai"><span class="icon_mini icon_tai" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="銃" href="#icon_ju"><span class="icon_mini icon_ju" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="小剣" href="#icon_sken"><span class="icon_mini icon_sken" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="弓" href="#icon_yumi"><span class="icon_mini icon_yumi" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="槍" href="#icon_yari"><span class="icon_mini icon_yari" onclick=""></span></a></li>
                            <li class="col-2 col-sm-1 xs-pad0"><a class="filterList pad0" data-type="WeaponTypeFilter" data-label="杖" href="#icon_tsue"><span class="icon_mini icon_tsue" onclick=""></span></a></li>
                        </ul>
                        <ul class="nav text-center width-100">
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#RS1">RS1</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#RS2">RS2</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#RS3">RS3</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#SF1">SF1</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#SF2">SF2</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#US">US</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#SS">SS</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#ES">ES</a></li>
                            <li class="col-2 col-sm-1 blockquote text-center"><a class="filterList pad0" data-type="SeriesFilter" href="#ES">RSR</a></li>
                        </ul>
                    </div>

                    <br>
                    <h6 id="listLabel" style="background: url(./img/bg_window_large.png);background-size: 100% 100%;color: #faf0b4;padding: 10px 30px;"><span id="label1"></span><span id="label2">みんなが登録した<br>ステータス最高値一覧</span></h6>

                    <label class="badge badge-pill badge-light">キャラクターをクリックすると詳細表示されます</label>
                    <div id="example-table-display" class="text-center">
                        <div id="example-table" style="width:402px"></div>
                    </div>
                    <br>
                    <div class="text-center kadomaru" style="background-color: rgba(42,169,239,1); color:white; margin: 0px 10px; padding: 2px 5px;">
                        <a href="./style.html" class="h4 " style="background-size: 340px 40px; width:340px" id="inputStyleLogined">自分のキャラを登録<i class="fas fa-pencil-alt"></i></a>
                    </div>

                    <br>
                    <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5008373409434899" data-ad-slot="3051702111"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({});</script>
                    <br>

                    <div id="initialHide" class="d-none">
                        <div class="text-center kadomaru" style="background-color: rgba(42,169,239,1); color:white; margin: 0px 10px; padding: 2px 5px;">
                            <a href="./style.html" class="h4 " style="background-size: 340px 40px; width:340px" id="inputStyleLogined">自分のキャラを登録<i class="fas fa-pencil-alt"></i></a>
                        </div>
                        <label class="badge badge-pill badge-light" id="badge">スタイル別上限の確認</label>
                        <table class="width-100 text-center style-bgcolor">
                            <tbody>
                                <tr class="text-center">
                                    <td colspan="11">
                                        <p class="width-100 pad0 mar0 darkButton charName">キャラ名</p>
                                    </td>
                                </tr>
                                <tr class="">
                                    <td class="dotBackground" rowspan="3" id="charDot">
                                    </td>
                                    <td colspan="11">ユーザ登録最大値</td>
                                </tr>
                                <tr class="text-center">
                                    <td class="paramHead paramCell2">腕</td>
                                    <td class="paramHead paramCell2">体</td>
                                    <td class="paramHead paramCell2">器</td>
                                    <td class="paramHead paramCell2">速</td>
                                    <td class="paramHead paramCell2">知</td>
                                    <td class="paramHead paramCell2">精</td>
                                    <td class="paramHead paramCell2">愛</td>
                                    <td class="paramHead paramCell2">魅</td>
                                    <td class="paramHead paramCell2"><span class="hidden pcBlock">合</span>計</td>
                                </tr>
                                <tr class="text-center">
                                    <td class="paramCell2"><span class="MAXSTR">99</span></td>
                                    <td class="paramCell2"><span class="MAXVIT">99</span></td>
                                    <td class="paramCell2"><span class="MAXDEX">99</span></td>
                                    <td class="paramCell2"><span class="MAXAGI">99</span></td>
                                    <td class="paramCell2"><span class="MAXINT">99</span></td>
                                    <td class="paramCell2"><span class="MAXMND">99</span></td>
                                    <td class="paramCell2"><span class="MAXAI">99</span></td>
                                    <td class="paramCell2"><span class="MAXMI">99</span></td>
                                    <td class="paramCell2"><span class="MAXSUM">999</span></td>
                                </tr>
                                <tr id="styleLabelRow">
                                    <td class="small">スタイル別<br>限界値(+12)</td>
                                    <td class="paramHead paramCell2">腕</td>
                                    <td class="paramHead paramCell2">体</td>
                                    <td class="paramHead paramCell2">器</td>
                                    <td class="paramHead paramCell2">速</td>
                                    <td class="paramHead paramCell2">知</td>
                                    <td class="paramHead paramCell2">精</td>
                                    <td class="paramHead paramCell2">愛</td>
                                    <td class="paramHead paramCell2">魅</td>
                                    <td class="paramHead paramCell2"><span class="hidden pcBlock">合</span>計</td>
                                </tr>
                                <tr class="text-center d-none" id="STYLE_TEMPLATE">
                                    <td class="IMG" style="width:10%">
                                        <img class="rare" src="./img/icon/icon_SS.png" width="25">
                                        <img class="icn" src="./img/style_icon/ID4c7d6.png" width="30">
                                    </td>
                                    <td class="paramCell2 STR">99</td>
                                    <td class="paramCell2 VIT">99</td>
                                    <td class="paramCell2 DEX">99</td>
                                    <td class="paramCell2 AGI">99</td>
                                    <td class="paramCell2 INT">99</td>
                                    <td class="paramCell2 MND">99</td>
                                    <td class="paramCell2 AI">99</td>
                                    <td class="paramCell2 MI">99</td>
                                    <td class="paramCell2 SUM">999</td>
                                </tr>
                                <tr id="MY_CHAR_TR" class="text-center" style="background-color: white;">
                                    <td class="text-right small">
                                        あなたの<span><br>キャラ</span>
                                    </td>
                                    <td class="paramCell1"><span class="YOURSTR">0</span></td>
                                    <td class="paramCell2"><span class="YOURVIT">0</span></td>
                                    <td class="paramCell2"><span class="YOURDEX">0</span></td>
                                    <td class="paramCell2"><span class="YOURAGI">0</span></td>
                                    <td class="paramCell2"><span class="YOURINT">0</span></td>
                                    <td class="paramCell2"><span class="YOURMND">0</span></td>
                                    <td class="paramCell2"><span class="YOURAI">0</span></td>
                                    <td class="paramCell2"><span class="YOURMI">0</span></td>
                                    <td class="paramCell2"><span class="YOURSUM">000</span></td>
                                </tr>                            
                            </tbody>
                        </table>

                        <br>
                        <table class="width-100 text-center style-bgcolor table-striped">
                            <tbody><tr class="small text-center ">
                                    <td colspan="11">
                                        <p class="width-100 pad0 mar0 darkButton">
                                            <i class="fas fa-crown"></i>
                                            <span class='charName'></span> 育成ランキング TOP20
                                            <i class="fas fa-crown"></i>
                                        </p>
                                    </td>
                                </tr>
                                <tr class="">
                                    <td class="dotBackground">
                                        <span id="charDotAruku" class="char dot_mid dot char-aruku"></span>
                                    </td>
                                    <td colspan="11" class="fukidashi">
                                        データ登録数 : <span id="INPUT_COUNT"></span>件<br>
                                        愛され度 : <span id="RANK_COUNT"></span>位 (<span id="CHAR_COUNT"></span>キャラ中)<br>
                                        あなたの順位 : <span id="MY_RANK">登録していません</span><br>
                                    </td>
                                </tr>
                                <tr class="text-center">
                                    <td class="paramHead paramCell2">Rank</td>
                                    <td class="paramHead paramCell2">腕</td>
                                    <td class="paramHead paramCell2">体</td>
                                    <td class="paramHead paramCell2">器</td>
                                    <td class="paramHead paramCell2">速</td>
                                    <td class="paramHead paramCell2">知</td>
                                    <td class="paramHead paramCell2">精</td>
                                    <td class="paramHead paramCell2">愛</td>
                                    <td class="paramHead paramCell2">魅</td>
                                    <td class="paramHead paramCell2"><span class="hidden pcBlock">合</span>計</td>
                                </tr>
                                <tr class="text-center" id="USER_RANK">
                                </tr>        
                            </tbody>
                        </table>
                        <br>
                        <div class="card"><div class="card-header bg-warning">ランキングについて</div><div class="card-body">このデータはユーザが入力した値を表示しています。上限を超える値も入力できてしまうため、おかしなデータが表示されてしまうケースもあります。正しいデータ入力のご協力をお願いいたします。</div></div>
                        <br>
                    </div>
                </div><!-- isLogin -->
                <hr>
                <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5008373409434899" data-ad-slot="3051702111"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
        </div>
        <script>
            var tableLimit = 15;
            var MY_DATA_LIST = [];
            var CHAR_RANK, CHAR_MASTER, STYLE_MASTER = [];
            var table;
            var LIMIT_BASE = 57;
            var allCharSize = 0;

            $(".filterList").click(function () {
                $(this).parent().toggleClass("filterActive");
                if (table === undefined) {
                    return;
                }
                filter();
                gtag('event', "clickFilter", {'event_category': "ourchar", 'event_label': $(this).attr("href").substr(1), 'value': 1});
            });

            let rand = Math.floor(Math.random() * 5);
            $(".dotBackground").addClass("bg" + (rand + 1));

            function filter() {
                let weaopnFilter = [];
                let seriesFilter = [];
                let weaopnLabel = [];
                let seriesLabel = [];
                $(".filterList").each(function () {
                    let target = $(this).attr("data-type");
                    let value = $(this).attr("href").substr(1);
                    if ($(this).parent().hasClass("filterActive")) {
                        if (target === "WeaponTypeFilter") {
                            weaopnFilter.push({field: target, type: "=", value: value});
                            weaopnLabel.push($(this).attr("data-label"));
                        } else {
                            seriesFilter.push({field: target, type: "=", value: value});
                            seriesLabel.push(value);
                        }
                    }
                });

                let labels = "";
                table.clearFilter();
                let finalFilter = [{field: "MAXSUM", type: ">", value: 0}];
                if (weaopnFilter.length > 0) {
                    finalFilter.push(weaopnFilter);
                    labels += "武器種:" + weaopnLabel.join(",");
                }
                if (seriesFilter.length > 0) {
                    finalFilter.push(seriesFilter);
                    if (labels !== "") {
                        labels += " & "
                    }
                    labels += seriesLabel.join(",");
                }
                if (labels !== "") {
                    labels += "<br>";
                }
                $("#label1").html(labels);
                table.setFilter(finalFilter);
                changeId2Dot();
            }

            $(document).on('click', ".tabulator-header, .tabulator-footer, .tabulator-page", function () {
                changeId2Dot();
            });
            $(document).on('click', ".tabulator-cell", function () {
                $("#initialHide").removeClass("d-none");

                let userMax = {"STR": 0, "VIT": 0, "DEX": 0, "AGI": 0, "INT": 0, "MND": 0, "AI": 0, "MI": 0, "SUM": 0};
                let styleMax = {"STR": 0, "VIT": 0, "DEX": 0, "AGI": 0, "INT": 0, "MND": 0, "AI": 0, "MI": 0, "SUM": 0};
                $(this).parent().find(".tabulator-cell").each(async function () {
                    let id = $(this).text();
                    let field = $(this).attr("tabulator-field");
                    if (id.indexOf("ID") > -1) {
                        $(".STYLE_ROW").remove();
                        $("#charDot").html(`<span class="char dot_mid dot char-winner" style="background: url(./img/dot/${CHAR_MASTER[id]['DotId']}.png) no-repeat; margin: 0 10px;"></span>`);
                        $(".charName").text(CHAR_MASTER[id]['Name']);
                        $("#charDotAruku").attr("style", `background: url(./img/dot/${CHAR_MASTER[id]['DotId']}.png) no-repeat; margin: 0 10px;`);

                        for (let styleId of CHAR_MASTER[id]['Holders']) {
                            let styleInfo = await getStyleInfo(styleId);
                            let styleRow = $("#STYLE_TEMPLATE").clone();
                            styleRow.removeAttr("id");
                            styleRow.addClass("STYLE_ROW");
                            styleRow.removeClass("d-none");
                            styleRow.find(".rare").attr("src", `./img/icon/icon_${styleInfo['Rarity']}.png`);
                            styleRow.find(".icn").attr("src", `./img/style_icon/${styleInfo['IllustId']}.png`);
                            let sum = 0;
                            for (let key of PARAM_KEY) {
                                let val = LIMIT_BASE + Number(styleInfo['Limit' + key]);
                                if (styleInfo['Limit' + key] < 99) {
                                    sum += val;
                                    styleMax[key] = (styleMax[key] < val) ? val : styleMax[key];
                                } else {
                                    val = "?";
                                }
                                styleRow.find("." + key).text(val);
                            }
                            styleRow.find(".SUM").text(sum);
                            $("#styleLabelRow").after(styleRow);
                        }
                        $(".STYLE_ROW").each(function () {
                            for (let key of PARAM_KEY) {
                                let td = $(this).find("." + key);
                                if (td.text() == styleMax[key]) {
                                    td.css("background-color", "lightgreen");
                                }
                            }
                        });
                        // スタイル複合最大値
                        let styleRowMax = $("#STYLE_TEMPLATE").clone();
                        styleRowMax.removeAttr("id").addClass("STYLE_ROW").removeClass("d-none")
                                .css("background-color", "rgba(0,0,0, 0.2)");
                        styleRowMax.find(".IMG").html("最大値");
                        let sum = 0;
                        for (let key of PARAM_KEY) {
                            sum += styleMax[key];
                            styleRowMax.find("." + key).text(styleMax[key]);
                        }
                        styleRowMax.find(".SUM").text(sum);
                        $("#styleLabelRow").after(styleRowMax);

                        // 自分の入力値
                        let myUserData = await getMyCharData(id);
                        if (myUserData === null) {
                            myUserData = {"STR": 0, "VIT": 0, "DEX": 0, "AGI": 0, "INT": 0, "MND": 0, "AI": 0, "MI": 0};
                        }
                        sum = 0;
                        for (let key of PARAM_KEY) {
                            sum += Number(myUserData[key]);
                            $(".YOUR" + key).text(myUserData[key]);
                        }
                        $(".YOURSUM").text(sum);

                        let userData = await getUserCharData(id);
                        let lim = 20;
                        let myRank = "登録がありません";
                        let nowrank = 1;
                        let nowsum = 999;
                        $(".USER_RANK_DISP").remove();
                        for (let idx in userData['list']) {
                            let sum = Number(userData['list'][idx]["SUM"]);
                            if (nowsum > sum) {
                                nowsum = sum;
                                nowrank = Number(idx) + 1;
                            }

                            let tr = $("<tr>").addClass("text-center USER_RANK_DISP");
                            if (UID === userData['list'][idx]['UserId']) {
                                tr.addClass("bg-white");
                                myRank = `${nowrank}位(${sum}pt)`;
                            }
                            if (idx >= lim) {
                                continue;
                            }

                            tr.append(`<td class='paramCell2'>${nowrank}</td>`)
                            for (let key of PARAM_KEY) {
                                tr.append(`<td class='paramCell2'>${userData['list'][idx][key]}</td>`)
                            }
                            tr.append(`<td class='paramCell2'>${sum}</td>`)
                            $("#USER_RANK").before(tr);
                        }
                        $("#MY_RANK").text(myRank);
                    } else if (field.indexOf("MAX") > -1) {
                        $("." + field).text(id);
                        userMax[field] = (userMax[field] < Number(id)) ? Number(id) : userMax[field];
                    } else if (field === "rank") {
                        $("#RANK_COUNT").text(id);
                    } else if (field === "size") {
                        $("#INPUT_COUNT").text(id);
                    } else if (field === "Name") {
                        gtag('event', "clickChar", {'event_category': "ourchar", 'event_label': id, 'value': 1});
                    }
                    $("#CHAR_COUNT").text(allCharSize);

                });
                $("html,body").animate({scrollTop: $('#badge').offset().top}, 500, 'swing');

            });

            readAnalyzeFile('OUR_CHAR/LIST', function (read) {
                CHAR_RANK = read;
                if (CHAR_RANK !== undefined && CHAR_MASTER !== undefined) {
                    init();
                }
            });
            readFile('Char', function (read) {
                CHAR_MASTER = read;
                if (CHAR_RANK !== undefined && CHAR_MASTER !== undefined) {
                    init();
                }
            });

            function init() {
                allCharSize = CHAR_RANK.length;
                let nowSize = 999;
                let nowRank = 1;
                for (let i in CHAR_RANK) {
                    let id = CHAR_RANK[i]['Id'];
                    CHAR_RANK[i]['DotId'] = "Dot" + CHAR_MASTER[id]['DotId'];
                    CHAR_RANK[i]['Name'] = CHAR_MASTER[id]['Name'];
                    CHAR_RANK[i]['Series'] = CHAR_MASTER[id]['Series'];
                    CHAR_RANK[i]['WeaponType'] = ICON_LIST[CHAR_MASTER[id]['WeaponType']];
                    CHAR_RANK[i]['SeriesFilter'] = CHAR_MASTER[id]['Series'];
                    CHAR_RANK[i]['WeaponTypeFilter'] = ICON_LIST[CHAR_MASTER[id]['WeaponType']];
                    if (nowSize > Number(CHAR_RANK[i]['size'])) {
                        nowSize = Number(CHAR_RANK[i]['size']);
                        nowRank = Number(i) + 1;
                    }
                    CHAR_RANK[i]['rank'] = nowRank;
                }
                drawTable(CHAR_RANK);
            }

            function changeId2Dot() {
                $("#example-table").find(".tabulator-cell").each(function () {
                    let id = $(this).text();
                    if (id.indexOf("Dot") > -1) {
                        let src = `<img src="./img/dot/${id.substr(3)}.png" style="object-position: -10px -10px">`;
                        $(this).html(src);
                    } else if (id.indexOf("icon") > -1) {
                        let src = `<span class="icon_mini_zokusei ${id}"></span>`;
                        $(this).html(src);
                    } else if (Number(id) < 5
                            && $(this).attr("tabulator-field") !== "MAXSUM"
                            && $(this).attr("tabulator-field") !== "DotId"
                            && $(this).attr("tabulator-field") !== "size"
                            ) {
                        let attr = $(this).attr("style");
                        $(this).attr("style", attr + ' background-color: palegreen;');
                    } else if (id.indexOf("x") > -1) {
                        let attr = $(this).attr("style");
                        $(this).attr("style", attr + ' background-color: lightslategray; color: white');
                    }
                });
            }

            function drawTable(result, sort) {
                let dir = (sort === undefined) ? "desc" : sort;
                $("#example-table").remove();
                $("#example-table-display").append('<div id="example-table" style="width:100%"></div>');

                let base = {align: "right", sortable: true, sorter: "number", minWidth: 30, width: 30};
                table = new Tabulator("#example-table", {
                    layout: "fitColumns",
                    data: result,
                    //layout: "fitColumns", //fit columns to width of table
                    //responsiveLayout: "hide", //hide columns that dont fit on the table
                    tooltips: false, //show tool tips on cells
                    history: true, //allow undo and redo actions on the table
                    pagination: "local", //paginate the data
                    paginationSize: tableLimit, //allow 7 rows per page of data
                    //movableColumns: true, //allow column order to be changed
                    //resizableRows: true, //allow row order to be changed
                    initialSort: [//set the initial sort order of the data
                        {column: "size", dir: dir},
                    ],
                    autoResize: false,
                    resizableRows: false,
                    resizableColumns: false,
                    responsiveLayout: true,
                    columns: [
                        {title: "", field: "DotId", width: 30, frozen: true},
                        {title: "名前", field: "Name", responsive: 8},
                        {title: "作品", field: "Series", width: 30, responsive: 10},
                        {title: "武器", field: "WeaponType", width: 30, responsive: 9},
                        {title: "", field: "Id", visible: false},
                        {title: "", field: "UserId", visible: false},
                        {title: "", field: "SeriesFilter", visible: false},
                        {title: "", field: "WeaponTypeFilter", visible: false},
                        Object.assign({title: "腕", field: "MAXSTR"}, base),
                        Object.assign({title: "体", field: "MAXVIT", }, base),
                        Object.assign({title: "器", field: "MAXDEX", }, base),
                        Object.assign({title: "速", field: "MAXAGI", }, base),
                        Object.assign({title: "知", field: "MAXINT", }, base),
                        Object.assign({title: "精", field: "MAXMND", }, base),
                        Object.assign({title: "愛", field: "MAXAI", }, base),
                        Object.assign({title: "魅", field: "MAXMI", }, base),
                        {title: '<span class="hidden pcBlock">合</span>計', field: "MAXSUM", sortable: true, sorter: "number"},
                        {title: "rank", field: "rank", visible: false},
                        {title: "登録数", field: "size", responsive: 11},
                    ],
                });

                table.setFilter("MAXSUM", ">", 0);
                changeId2Dot();
            }
        </script>
        <!-- Twitter universal website tag code -->
        <script>
            !function (e, t, n, s, u, a) {
                e.twq || (s = e.twq = function () {
                    s.exe ? s.exe.apply(s, arguments) : s.queue.push(arguments);
                }, s.version = '1.1', s.queue = [], u = t.createElement(n), u.async = !0, u.src = '//static.ads-twitter.com/uwt.js',
                        a = t.getElementsByTagName(n)[0], a.parentNode.insertBefore(u, a))
            }(window, document, 'script');
            // Insert Twitter Pixel ID and Standard Event data below
            twq('init', 'o1u7p');
            twq('track', 'PageView');
        </script>
        <!-- End Twitter universal website tag code -->
    </body>
</html>
